import express from "express";
import { verifyFirebaseToken } from "../middlewares/auth.js";
import { checkMessageLimit } from "../middlewares/limits.js";
import { db } from "../config/firebase.js";

const router = express.Router();

router.post("/", verifyFirebaseToken, checkMessageLimit, async (req, res) => {
  try {
    const { message } = req.body;

    if (!message)
      return res.status(400).json({ error: "message required" });

    // Placeholder AI response
    const reply = `BlueMind AI says: ${message}`;

    await db.collection("users").doc(req.uid).update({
      messagesUsed: (req.user.messagesUsed || 0) + 1,
    });

    res.json({ success: true, reply });
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

export default router;