import { Router } from "express";
import { asyncHandler } from "../utils/asyncHandler.js";
import { ensureUser } from "../services/userService.js";

export const userRoutes = Router();

// POST /create-user  Body: { uid, email }
userRoutes.post(
  "/create-user",
  asyncHandler(async (req, res) => {
    const uid = req.body?.uid || req.auth?.uid;
    const email = req.body?.email || req.auth?.email || "";

    if (!uid) return res.status(400).json({ error: "uid required" });

    const user = await ensureUser(uid, email);
    res.json({ success: true, uid, user });
  })
);